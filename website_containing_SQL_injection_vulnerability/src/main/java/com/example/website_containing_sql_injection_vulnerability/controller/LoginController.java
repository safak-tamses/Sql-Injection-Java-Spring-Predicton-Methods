package com.example.website_containing_sql_injection_vulnerability.controller;

import com.example.website_containing_sql_injection_vulnerability.model.User;
import com.example.website_containing_sql_injection_vulnerability.service.UserService;
import lombok.AllArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
@RequestMapping()
@AllArgsConstructor
public class LoginController {
    private final UserService userService;

    @GetMapping("/login")
    public String login() {
        return "login"; // "login.html" şablonunu döndürür
    }

    @PostMapping("/welcome")
    public String welcome(@RequestParam("username") String username, @RequestParam("password") String password, Model model) {
        // Kullanıcı adı ve şifre doğrulaması yap
        if (userService.findByUsernameAndPassword(username, password)) {
            // Doğrulama başarılı ise, model nesnesine kullanıcı adını ekle
            model.addAttribute("username", username);
            // welcome.html sayfasına yönlendir
            return "welcome";
        } else {
            // Doğrulama başarısız ise, model nesnesine bir hata mesajı ekle
            model.addAttribute("error", "Invalid username or password");
            // login.html sayfasına geri dön
            return "login";
        }
    }
}